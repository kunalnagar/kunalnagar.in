<!DOCTYPE html>
<html lang="en" class="light">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="I like to keep my bash prompt clean and simple. Learn how to setup a minimal bash prompt." />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <title>Customize your Bash Prompt - Kunal Nagar</title>
    <meta
      property="og:image"
      content="https://kunalnagar.in/assets/img/post.png"
    />
    <meta property="og:title" content="Customize your Bash Prompt - Kunal Nagar" />
    <meta property="og:description" content="I like to keep my bash prompt clean and simple. Learn how to setup a minimal bash prompt." />
    <meta property="og:url" content="https://kunalnagar.in/blog/customize-bash-prompt/" />
    <meta property="og:type" content="article" />
    <meta name="robots" content="index, follow" />
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
  </head>
  <body>
    <main>
      <nav>
  <ul>
    <li><a href="/">Kunal Nagar</a></li>
    <li><a href="/foss">Open Source</a></li>
    <li><a href="/blog">Blog</a></li>
  </ul>
</nav>

      <div class="page page-blog-single">
        <section class="section">
          <h1>Customize your Bash Prompt</h1>
          <time class="muted">February 23, 2019</time>
        </section>
        <article><p>I like to keep my bash prompt really minimal. I’m not into colours. I’m not into fancy fonts. I want my prompt to show contextual information so I can focus on the work I’m doing.</p>

<p>By default, macOS gives you this terminal:</p>

<p><img src="https://i.imgur.com/n57DPG3.png" alt="" /></p>

<p>I fucking hate it. Why do I need to see my machine name every time I open the terminal? <a href="https://www.merriam-webster.com/dictionary/phooey">Phooey</a>.</p>

<p>Plus, when I navigate to a git repo, it doesn’t even show what branch I’m on. Double phooey.</p>

<p><img src="https://i.imgur.com/sNgVmfJ.png" alt="" /></p>

<h2 id="my-setup">My setup</h2>

<p>Here’s what I have and I’m really happy with it.</p>

<p><img src="https://i.imgur.com/3Dwoh1Z.png" alt="" /></p>

<h2 id="what-do-i-like-about-it">What do I like about it?</h2>

<p>Couple of things:</p>

<ul>
  <li>Shows me what user I’m logged in as (good on unix systems when you want to switch between root and normal user)</li>
  <li>Shows me the full (read FULL) path of where I am. Yes, FULL.</li>
  <li>Shows me the branch I’m on (if I’m in a git repo)</li>
</ul>

<p>Things I don’t need here:</p>

<ul>
  <li>Machine name</li>
  <li>Date</li>
  <li>10 billion colours</li>
  <li>Emoji.      <small><small><small>Well…</small></small></small></li>
</ul>

<h2 id="how-to-set-it-up">How to set it up</h2>

<p>If you’re really impressed by it and just want the code, copy paste the following in your <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> and move on with your life.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">git_prompt<span class="o">()</span> <span class="o">{</span>

    <span class="nb">local </span><span class="nv">branchName</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>

    <span class="c"># Check if the current directory is in a Git repository.</span>
    <span class="k">if </span>git rev-parse <span class="nt">--git-dir</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span><span class="nv">branchName</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>git symbolic-ref <span class="nt">--quiet</span> <span class="nt">--short</span> HEAD 2&gt; /dev/null <span class="o">||</span> <span class="se">\</span>
	        git rev-parse <span class="nt">--short</span> HEAD 2&gt; /dev/null <span class="o">||</span> <span class="se">\</span>
		    <span class="nb">echo</span> <span class="s1">'(unknown)'</span><span class="si">)</span><span class="s2">"</span><span class="p">;</span>
        <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"(</span><span class="k">${</span><span class="nv">branchName</span><span class="k">}</span><span class="s2">)"</span><span class="p">;</span>
    <span class="k">else
        return</span><span class="p">;</span>
    <span class="k">fi</span><span class="p">;</span>

<span class="o">}</span>

<span class="nv">PS1</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">[</span><span class="se">\u</span><span class="s2">] at </span><span class="se">\w</span><span class="s2">"</span><span class="p">;</span>

PS1+<span class="o">=</span><span class="s2">" </span><span class="se">\$</span><span class="s2">(git_prompt)"</span><span class="p">;</span>

PS1+<span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">=&gt; "</span><span class="p">;</span></code></pre></figure>

<p>If you’re like me and want to understand what this gibberish means, read on.</p>

<p>The <code class="language-plaintext highlighter-rouge">git_prompt()</code> method spits out the current branch name, if it exists. Let’s try to break it down.</p>

<h2 id="step-1">Step 1</h2>

<p>Let’s run the first half of the command in a git repo and a normal folder and see what happens</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>kunalnagar] at ~/Documents/Code/personal-main <span class="o">(</span>updates-v3<span class="o">)</span>
<span class="o">=&gt;</span> git rev-parse <span class="nt">--git-dir</span>
.git

<span class="o">[</span>kunalnagar] at ~/Documents/Code/personal-main <span class="o">(</span>updates-v3<span class="o">)</span>
<span class="o">=&gt;</span> <span class="nb">cd</span> ..

<span class="o">[</span>kunalnagar] at ~/Documents/Code
<span class="o">=&gt;</span> git rev-parse <span class="nt">--git-dir</span>
fatal: not a git repository <span class="o">(</span>or any of the parent directories<span class="o">)</span>: .git</code></pre></figure>

<p>So basically, this command is used to check if our current working directory is a git repo or not.</p>

<p>What’s the writing to <code class="language-plaintext highlighter-rouge">/dev/null</code> and <code class="language-plaintext highlighter-rouge">2&gt;&amp;1</code> mean? Read more <a href="https://askubuntu.com/questions/12098/what-does-outputting-to-dev-null-accomplish-in-bash-scripts">here</a></p>

<h2 id="step-2">Step 2</h2>

<p>Once we’ve figured out that we are, actually, inside a git repo, we need to figure out what branch we’re in. Now please note that this can get fairly complicated with detached HEAD states etc. which is where most solutions on the internet fail. This is the best one I’ve found that works across a wide range of scenarios.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>kunalnagar] at ~/Documents/Code/personal-main <span class="o">(</span>updates-v3<span class="o">)</span>
<span class="o">=&gt;</span> git symbolic-ref <span class="nt">--quiet</span> <span class="nt">--short</span> HEAD 2&gt; /dev/null
updates-v3

<span class="o">[</span>kunalnagar] at ~/Documents/Code/personal-main <span class="o">(</span>updates-v3<span class="o">)</span>
<span class="o">=&gt;</span> <span class="nb">cd</span> ..

<span class="o">[</span>kunalnagar] at ~/Documents/Code
<span class="o">=&gt;</span> git symbolic-ref <span class="nt">--quiet</span> <span class="nt">--short</span> HEAD 2&gt; /dev/null</code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">git symbolic-ref</code> allows us to read, modify and delete <a href="https://stackoverflow.com/a/1526526">symbolic refs</a></p>

<p>For more information on the flags, check out <a href="https://git-scm.com/docs/git-symbolic-ref#git-symbolic-ref---quiet"><code class="language-plaintext highlighter-rouge">--quiet</code></a> and <a href="https://git-scm.com/docs/git-symbolic-ref#git-symbolic-ref---short"><code class="language-plaintext highlighter-rouge">--short</code></a></p>

<p>As you can see from the above example, when the above command is run, it spits out the branch name.</p>

<p>The <code class="language-plaintext highlighter-rouge">git rev-parse</code> is used as a safety net in scenarios like detached heads where we might need to pick out params from a lot of info</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>kunalnagar] at ~/Documents/Code/personal-main <span class="o">(</span>updates-v3<span class="o">)</span>
<span class="o">=&gt;</span> git symbolic-ref <span class="nt">--quiet</span> <span class="nt">--short</span> HEAD 2&gt; /dev/null <span class="o">||</span> git rev-parse
updates-v3</code></pre></figure>

<h2 id="step-3">Step 3</h2>

<p>Cool, now we have the branch name. Now we just need to set the bash variable <code class="language-plaintext highlighter-rouge">PS</code> to show our minimal prompt</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nv">PS1</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">[</span><span class="se">\u</span><span class="s2">] at </span><span class="se">\w</span><span class="s2">"</span><span class="p">;</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">\n</code>: New line</p>

<p><code class="language-plaintext highlighter-rouge">\u</code>: Current user (name)</p>

<p><code class="language-plaintext highlighter-rouge">\w</code>: Path relative to home (notice the tilda in the path names in the screenshots)</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">PS1+<span class="o">=</span><span class="s2">" </span><span class="se">\$</span><span class="s2">(git_prompt)"</span><span class="p">;</span></code></pre></figure>

<p>This appends the branch name in parentheses (if it’s a git repo)</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">PS1+<span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">=&gt; "</span><span class="p">;</span></code></pre></figure>

<p>Just a new line. With a short arrow.</p>

<p>And we’re done! Hope this made sense. Bash scripting is fun. A side project I’m working on is to transition my SCSS compilation to CSS using Makefiles. Will post my findings soon.</p>
</article>
        <script
          src="https://giscus.app/client.js"
          data-repo="kunalnagar/kunalnagar.in-comments"
          data-repo-id="R_kgDOJ3RUnQ"
          data-category="Announcements"
          data-category-id="DIC_kwDOJ3RUnc4CXqVX"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="top"
          data-theme="light"
          data-lang="en"
          data-loading="lazy"
          crossorigin="anonymous"
          async
        ></script>
      </div>
    </main>
    
  </body>
</html>
